---
title: |
       | 10 Random Forest
author: "Fabian Blasch"
date: "`r format(Sys.Date(), format = '%m/%d/%Y')`"
header-includes:
   - \usepackage{amsmath}
   - \usepackage{amssymb}
   - \usepackage{float}
   - \usepackage{titling}
   - \usepackage{xcolor}
output: 
   pdf_document:
      number_sections: TRUE
---

# Load Data

```{r, results = "hide", message = FALSE, warning = FALSE}
# source AUX
source("./../Misc/Auxilliary.R")
source("./../Misc/model_eval.R")

# packages
get.package(c("lubridate", "glmnet", "glmnetUtils", "tidyverse",
              "ranger", "caret", "beepr"))

# load data
dat_bids <- readRDS("./../../Data/Bid Tab RDS/Bids_df_split.RDS")
dat_aucs <- readRDS("./../../Data/Bid Tab RDS/Aucs_df_split.RDS")
```

# Auction Level

## No Feature Engineering

### Variable Removal

```{r}
# exclude variables that are not supposed to be in the model
lapply(dat_aucs, \(x){

  # remove
  x$Contract_ID <- NULL
  x$MLOT <- NULL
  
  # return
  return(x)
  
}) -> dat_aucs_mod

# assign training set
dat_train_aucs <- dat_aucs_mod[["Train"]]
```

### Cross Validation

```{r}
# control
ctrl <- caret::trainControl(method = "repeatedcv", number = 5, repeats = 2)

# tuning grid
tgrid <- expand.grid("mtry" = seq(25, 500, 50),
                     "splitrule" = "variance",
                     "min.node.size" = 1:3)

rf <- caret::train(EW_Diff ~ ., data = dat_train_aucs, method = "ranger",
                   metric = "RMSE", tuneGrid = tgrid, trControl = ctrl,
                   num.threads = 8, verbose = TRUE)

# save
saveRDS(rf, "./../../Data/Models/RF/Raw/cvfitRF.RDS")
```

